---
Rtitle: "Projet Final"
author: "Samuel CHICHA"
date: "10/03/2020"
output: pdf_document
params:
  pokemon: "Persian"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
#Checking if library is well imported and install them if not
if(!require(readr)){
  install.packages("readr")
  require(readr)
}
if(!require(dplyr)){
  install.packages("dplyr")
  require(dplyr)
}
if(!require(ggplot2)){
  install.packages("ggplot2")
  require(ggplot2)
}
if(!require(fmsb)){
  install.packages("fmsb")
  require(fmsb)
}
#Checking if dataset exists and download it if not
if(!file.exists("data/pokemon.csv"))
  download.file(url = "https://courses.datacrunch.sh/courses/intro-analyse-r/TD6/pokemon.csv", destfile = "data/pokemon.csv", mode = "wb")
pokemons <- read_csv("data/pokemon.csv")
```

# Base de données

```{r intro_bd, echo=FALSE}
#Computing number of generations, pokemons and legendary ones
nb_gen <- unique(pokemons$Generation) %>% length()
nb_pokemons <- nrow(pokemons)
nb_leg <- pokemons[pokemons$Legendary == TRUE,] %>% nrow()
picked <- params$pokemon
```

La base de données présente une liste de `r nb_pokemons` pokémons étalés sur `r nb_gen` générations dont `r nb_leg` sont légendaires. 
Nous étudierons ici le pokémon "`r picked`".

# Etude du pokémon

```{r intro_persian, echo=FALSE}
#Getting the pokemon we picked
pokemon <- filter(pokemons, Name == picked)
```
>
> __Nom__: `r pokemon$Name`
>
> __Type__: `r pokemon$'Type 1'`
>
> __Points de vie__: `r pokemon$HP`
>
> __Attaque__: `r pokemon$Attack`
>
> __Defense__: `r pokemon$Defense`
>
> __Attaque spécial__: `r pokemon$'Sp. Atk'`
>
> __Défense spécial__: `r pokemon$'Sp. Def'`
>
> __Vitesse__: `r pokemon$Speed`

```{r first_comparison, echo=FALSE}
#Getting pokemons of the same generation than the one we picked
same_gen_pokemons <- filter(pokemons, Generation == pokemon$Generation)

#Creating minimum row
result.min <- cbind(min(pokemons$HP), min(pokemons$Attack), min(pokemons$Defense), min(pokemons$`Sp. Atk`), min(pokemons$`Sp. Def`), min(pokemons$Speed))
colnames(result.min) <- same_gen_pokemons[5:10] %>% colnames()
rownames(result.min) <- "Minimum"

#Creating maximum row
result.max <- cbind(max(pokemons$HP), max(pokemons$Attack), max(pokemons$Defense), max(pokemons$`Sp. Atk`), max(pokemons$`Sp. Def`), max(pokemons$Speed))
colnames(result.max) <- same_gen_pokemons[5:10] %>% colnames()
rownames(result.max) <- "Maximum"

#Creating mean row
result.mean <- cbind(mean(pokemons$HP), mean(pokemons$Attack), mean(pokemons$Defense), mean(pokemons$`Sp. Atk`), mean(pokemons$`Sp. Def`), mean(pokemons$Speed))
colnames(result.mean) <- same_gen_pokemons[5:10] %>% colnames()
rownames(result.mean) <- "Moyenne"

#Subdata of our pokemon
sub <- cbind(pokemon$HP, pokemon$Attack, pokemon$Defense, pokemon$`Sp. Atk`, pokemon$`Sp. Def`, pokemon$Speed)
colnames(sub) <- same_gen_pokemons[5:10] %>% colnames()
rownames(sub) <- picked

#Gathering results
result <- rbind(result.max, result.min, result.mean, sub) %>% as.data.frame()

# Radar chart color assignment
colors_border <- c( rgb(0.2,0.5,0.5,0.9), rgb(0.8,0.2,0.5,0.9), rgb(0.7,0.5,0.1,0.9))
colors_in <- c( rgb(0.2,0.5,0.5,0.4), rgb(0.8,0.2,0.5,0.4), rgb(0.7,0.5,0.1,0.4))

# Creating the chart
# https://www.rdocumentation.org/packages/fmsb/versions/0.7.0/topics/radarchart
radarchart(result, axistype=1, pcol=colors_border, pfcol=colors_in, plwd=4, plty=1, cglcol="grey", cglty=1, axislabcol="grey", cglwd=0.8, vlcex=0.8)

# Add a legend
legend(x=1.3, y=1.3, legend=rownames(result[-c(1,2),]), bty="n", pch=20 , col=colors_in , text.col="black", cex=1.2, pt.cex=3)

```

# Battre Lugia